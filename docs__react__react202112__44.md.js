(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[50],{"0Xa6":function(n,e,t){"use strict";t.r(e);var o=t("q1tI"),a=t.n(o),r=t("dEAq"),c=t("H1Ra"),i=a.a.memo((n=>{n.demos;return a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:"markdown"},a.a.createElement("h1",{id:"\u5b9e\u73b0promise\u548cthunk\u4e2d\u95f4\u4ef6"},a.a.createElement(r["AnchorLink"],{to:"#\u5b9e\u73b0promise\u548cthunk\u4e2d\u95f4\u4ef6","aria-hidden":"true",tabIndex:-1},a.a.createElement("span",{className:"icon icon-link"})),"\u5b9e\u73b0promise\u548cthunk\u4e2d\u95f4\u4ef6"),a.a.createElement("h2",{id:"srccomponentscounter1js"},a.a.createElement(r["AnchorLink"],{to:"#srccomponentscounter1js","aria-hidden":"true",tabIndex:-1},a.a.createElement("span",{className:"icon icon-link"})),"src/components/Counter1.js"),a.a.createElement(c["a"],{code:"import React from 'react'\nimport actionCreators from \"../store/actionCreators/counter1\";\nimport { useSelector, useBoundDispatch } from  '../react-redux'\n\nfunction Counter1() {\n  let state = useSelector((state) => state.counter1)\n  let dispatch = useBoundDispatch(actionCreators);\n  return (\n    <div>\n      <p>{state.number}</p>\n      <button onClick={dispatch.add}>+</button>\n      <button onClick={dispatch.minus}>-</button>\n+      <button onClick={dispatch.thunk}>thunkAdd</button>\n+      <button onClick={dispatch.promise1Add}>promise1Add</button>\n+      <button onClick={dispatch.promise2Add}>promise2Add</button>\n    </div>\n  )\n}\n\nexport default Counter1",lang:"diff"}),a.a.createElement("h2",{id:"srcstoreactioncreatorscounter1js"},a.a.createElement(r["AnchorLink"],{to:"#srcstoreactioncreatorscounter1js","aria-hidden":"true",tabIndex:-1},a.a.createElement("span",{className:"icon icon-link"})),"src/store/actionCreators/counter1.js"),a.a.createElement(c["a"],{code:'import * as actionType from "../action-types";\n\nfunction add() {\n  return { type: actionType.ADD }\n}\n\nfunction minus() {\n  return { type: actionType.MINUS }\n}\n\n+ function thunk() {\n+   return function (dispatch, getState) {\n+     setTimeout(() => {\n+       dispatch({type: actionType.ADD})\n+     }, 1000)\n+   }\n+ }\n\n+ function promise1Add() {\n+   return new Promise((resolve, reject) => {\n+     setTimeout(() => {\n+       resolve({type: actionType.ADD})\n+     }, 1000)\n+   })\n+ }\n\n+ function promise2Add() {\n+   return {\n+     type: actionType.ADD,\n+     payload: new Promise((resolve, reject) => {\n+       setTimeout(() => {\n+         if (Math.random() >.5) {\n+           resolve({amount: 1})\n+         } else {\n+           reject({amount: -5})\n+         }\n+       }, 1000)\n+     })\n+   }\n+ }\n\n+ const actionCreators = { add, minus, thunk, promise1Add, promise2Add }\n\nexport default actionCreators',lang:"diff"}),a.a.createElement("h2",{id:"srcstoreredux-promisejs"},a.a.createElement(r["AnchorLink"],{to:"#srcstoreredux-promisejs","aria-hidden":"true",tabIndex:-1},a.a.createElement("span",{className:"icon icon-link"})),"src/store/redux-promise.js"),a.a.createElement(c["a"],{code:"function promise({ dispatch, getState }) {\n  return function (next) {\n    return function (action) {\n      // \u5982\u679c\u4e00\u4e2a\u5bf9\u8c61\u6709 then \u5c5e\u6027\uff0c\u5e76\u4e14 then \u5c5e\u6027\u7684\u7c7b\u578b\u662f\u4e00\u4e2a\u51fd\u6570\n      if (action.then && typeof action.then === 'function') {\n        // \u6267\u884c\u8fd9\u4e2a\u51fd\u6570\uff0c\u4f20\u5165 dispatch \u548c getState\n        action.then(action => dispatch(action)).catch(dispatch)\n      } else if (action.payload && typeof action.payload.then === 'function') {\n        action.payload  // \u5982\u679c\u6210\u529f\u4e86\uff0c\u5219\u91cd\u65b0\u6d3e\u53d1\u4e00\u4e2a action, \u628a payload \u4fee\u6539\u4e3a\u8fd4\u56de\u7684\u503c 1\n          .then(result => dispatch({...action, error: true, payload: result}))\n          .catch(error => {\n            dispatch({...action, payload: error})\n            return Promise.reject(error)\n          })\n      } else {\n        return next(action)\n      }\n    }\n  }\n}\n\nexport default promise",lang:"js"}),a.a.createElement("h2",{id:"srcstoreredux-thunkjs"},a.a.createElement(r["AnchorLink"],{to:"#srcstoreredux-thunkjs","aria-hidden":"true",tabIndex:-1},a.a.createElement("span",{className:"icon icon-link"})),"src/store/redux-thunk.js"),a.a.createElement(c["a"],{code:"function thunk({ dispatch, getState }) {\n  return function (next) {\n    return function (action) {\n      // \u5982\u679c\u8bf4\u6d3e\u53d1\u7684 action \u662f\u4e00\u4e2a\u51fd\u6570\u7684\u8bdd\n      if (typeof action === 'function') {\n        // \u6267\u884c\u8fd9\u4e2a\u51fd\u6570\uff0c\u4f20\u5165 dispatch \u548c getState\n        return action(dispatch, getState)\n      } else {\n        return next(action)\n      }\n    }\n  }\n}\n\nexport default thunk",lang:"js"})))}));e["default"]=n=>{var e=a.a.useContext(r["context"]),t=e.demos;return a.a.useEffect((()=>{var e;null!==n&&void 0!==n&&null!==(e=n.location)&&void 0!==e&&e.hash&&r["AnchorLink"].scrollToAnchor(decodeURIComponent(n.location.hash.slice(1)))}),[]),a.a.createElement(i,{demos:t})}}}]);