(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[52],{"1prS":function(e,n,t){"use strict";t.r(n);var a=t("q1tI"),o=t.n(a),r=t("dEAq"),i=t("H1Ra"),l=o.a.memo((e=>{e.demos;return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"markdown"},o.a.createElement("h1",{id:"\u5b9e\u73b0\u5408\u6210\u4e8b\u4ef6"},o.a.createElement(r["AnchorLink"],{to:"#\u5b9e\u73b0\u5408\u6210\u4e8b\u4ef6","aria-hidden":"true",tabIndex:-1},o.a.createElement("span",{className:"icon icon-link"})),"\u5b9e\u73b0\u5408\u6210\u4e8b\u4ef6"),o.a.createElement("p",null,"React v15\u4e8b\u4ef6\u548cReact v17\u6709\u6240\u4e0d\u540c"),o.a.createElement("p",null,"\u6700\u5927\u7684\u4e0d\u540c\u70b9\uff0c15\u7684\u4e8b\u4ef6\u90fd\u662f\u4ee3\u7406\u5230 document\uff0c17\u4e4b\u540e\u90fd\u4ee3\u7406\u7ed9\u4e86\u5bb9\u5668 div#root"),o.a.createElement("p",null,"\u56e0\u4e3aReact\u5e0c\u671b\u4e00\u4e2a\u9875\u9762\u53ef\u4ee5\u8fd0\u884c\u591a\u4e2a react \u7248\u672c"),o.a.createElement("h2",{id:"\u6e90\u7801"},o.a.createElement(r["AnchorLink"],{to:"#\u6e90\u7801","aria-hidden":"true",tabIndex:-1},o.a.createElement("span",{className:"icon icon-link"})),"\u6e90\u7801"),o.a.createElement("p",null,"src/event.js"),o.a.createElement(i["a"],{code:"import { updateQueue } from \"./Component\";\n\n/**\n * \u7ed9 DOM \u6dfb\u52a0\u5408\u6210\u4e8b\u4ef6\n * \u4e0d\u662f\u5929\u7136\u7684\uff0c\u4eba\u5de5\u5408\u6210\u7684\n * \u4e3a\u4ec0\u4e48\u8981\u5408\u6210\uff1f\n * 1. \u505a\u4e00\u4e2a\u7c7b\u4f3c\u9762\u5411\u5207\u9762\u7f16\u7a0b\u7684\u64cd\u4f5c AOP\u3002\u5728\u7528\u6237\u81ea\u5df1\u7684 handler \u51fd\u6570\u4e4b\u524d\u505a\u4e00\u4e9b\u4e8b\u60c5\uff0c\u4e4b\u540e\u505a\u4e00\u4e9b\u4e8b\u60c5\n * 2. \u5904\u7406\u6d4f\u89c8\u5668\u7684\u517c\u5bb9\u6027 \u63d0\u4f9b\u517c\u5bb9\u6240\u6709\u7684\u6d4f\u89c8\u5668\u7edf\u4e00\u7684 API\uff0c\u5c4f\u853d\u6d4f\u89c8\u5668\u5dee\u5f02\n * @param dom \u7ed1\u5b9a\u4e8b\u4ef6\u7684\u771f\u5b9eDOM button\n * @param eventType onclick \u7ed1\u5b9a\u65f6\u5019\u7684\u5c5e\u6027\u540d\n * @param handler \u7528\u6237\u81ea\u5df1\u7f16\u5199\u7684\u4e8b\u4ef6\u5904\u7406\u51fd\u6570\n */\nfunction addEvent(dom, eventType, handler) {\n  // button._store = {}\n  let store = dom._store || (dom._store = {});\n  // button._store['onclick'] = handleClick\n  store[eventType] = handler;\n  if (!document[eventType])\n    document[eventType] = dispatchEvent\n}\n\n/**\n * document \u8eab\u4e0a\u7ed1\u5b9a\u7684\u70b9\u51fb\u4e8b\u4ef6\u7684\u4e8b\u4ef6\u5904\u7406\u51fd\u6570\n * @param nativeEvent\n */\nfunction dispatchEvent(nativeEvent) {\n  updateQueue.isBatchingUpdate = true\n\n  // type = click target \u4e8b\u4ef6\u6e90DOM \u70b9\u51fb\u7684\u662f button \u7684\u8bdd\u5c31\u662f button\n  let { type, target } = nativeEvent\n  let eventType = `on${type}`;  // onclick\n  let syntheticEvent = createSyntheticEvent(nativeEvent);\n\n  while(target) { // \u6a21\u62df\u5b9e\u73b0\u4e8b\u4ef6\u5192\u6ce1\n    let { _store } = target;\n    let handler = _store && _store[eventType]\n    if (handler) handler(syntheticEvent)\n    if (syntheticEvent.isPropagationStopped) {\n      break;\n    }\n    target = target.parentNode;\n  }\n\n  updateQueue.batchUpdate()\n}\n\nfunction createSyntheticEvent(nativeEvent) {\n  let syntheticEvent = {}\n  for (let key in nativeEvent) {\n    let value = nativeEvent[key];\n    if (typeof value === 'function') value = value.bind(nativeEvent)\n    syntheticEvent[key] = nativeEvent[key]\n  }\n  syntheticEvent.nativeEvent = nativeEvent\n  syntheticEvent.isPropagationStopped = false;  // \u5f53\u524d\u662f\u5426\u5df2\u7ecf\u963b\u6b62\u5192\u6ce1\u4e86\n  syntheticEvent.stopPropagation = stopPropagation; // \u8c03\u7528\u6b64\u65b9\u6cd5\u53ef\u4ee5\u963b\u6b62\u5192\u6ce1\n  syntheticEvent.defaultPrevented = false;  // \u5f53\u524d\u662f\u5426\u5df2\u7ecf\u963b\u6b62\u5192\u6ce1\u4e86\n  syntheticEvent.preventDefault = preventDefault; // \u8c03\u7528\u6b64\u65b9\u6cd5\u53ef\u4ee5\u963b\u6b62\u5192\u6ce1\n  return syntheticEvent;\n}\n\nfunction preventDefault() {\n  const event = this.nativeEvent;\n  if (event.preventDefault) {  // \u6807\u51c6\u6d4f\u89c8\u5668\n    event.preventDefault()\n  } else {  // IE \u6d4f\u89c8\u5668\n    event.returnValue = false\n  }\n  this.defaultPrevented = true\n}\n\nfunction stopPropagation() {\n  const event = this.nativeEvent;\n  if (event.stopPropagation) {  // \u6807\u51c6\u6d4f\u89c8\u5668\n    event.stopPropagation()\n  } else {  // IE \u6d4f\u89c8\u5668\n    event.cancelBubble = true\n  }\n  this.isPropagationStopped = true\n}\n\nexport {\n  addEvent\n}",lang:"js"}),o.a.createElement("p",null,"src/react-dom.js"),o.a.createElement(i["a"],{code:"import {REACT_TEXT} from \"./constants\";\n+ import {addEvent} from \"./event\";\n\nfunction render(vdom, container) {\n  mount(vdom, container)\n}\n\n// ....\n\n/**\n * \u66f4\u65b0\u771f\u5b9e DOM \u7684\u5c5e\u6027\n * @param dom\n * @param oldProps\n * @param newProps\n */\nfunction updateProps(dom, oldProps = {}, newProps = {}) {\n  for (let key in newProps) {\n    if (key === 'children') {\n      continue\n    } else if (key === 'style') {\n      let styleObj = newProps[key];\n      for (let attr in styleObj) {\n        dom.style[attr] = styleObj[attr];\n      }\n    } else if(/^on[A-Z].*/.test(key)) {\n+      // dom[key.toLowerCase()] = newProps[key];\n+      addEvent(dom, key.toLowerCase(), newProps[key])\n    } else {\n      dom[key] = newProps[key]\n    }\n  }\n\n  // \u5982\u679c\u5c5e\u6027\u5728\u8001\u5f97\u5c5e\u6027\u91cc\uff0c\u65b0\u7684\u5c5e\u6027\u6ca1\u6709\uff0c\u9700\u8981\u4ece\u771f\u5b9e DOM \u4e2d\u5220\u9664\n  for (let key in oldProps) {\n    if (!newProps.hasOwnProperty(key)) {\n      dom[key] = null;\n    }\n  }\n}",lang:"diff"})))}));n["default"]=e=>{var n=o.a.useContext(r["context"]),t=n.demos;return o.a.useEffect((()=>{var n;null!==e&&void 0!==e&&null!==(n=e.location)&&void 0!==n&&n.hash&&r["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),o.a.createElement(l,{demos:t})}}}]);