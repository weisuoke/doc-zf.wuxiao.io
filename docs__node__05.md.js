(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[9],{cGcl:function(e,n,t){"use strict";t.r(n);var r=t("q1tI"),s=t.n(r),o=t("dEAq"),a=t("H1Ra"),i=s.a.memo((e=>{e.demos;return s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"markdown"},s.a.createElement("h1",{id:"promise\u7684\u94fe\u5f0f\u8c03\u7528"},s.a.createElement(o["AnchorLink"],{to:"#promise\u7684\u94fe\u5f0f\u8c03\u7528","aria-hidden":"true",tabIndex:-1},s.a.createElement("span",{className:"icon icon-link"})),"promise\u7684\u94fe\u5f0f\u8c03\u7528"),s.a.createElement("p",null,"7.promise.js"),s.a.createElement(a["a"],{code:"// let promise = new Promise((resolve, reject) => {\n//   resolve('ok')\n// })\n//\n// promise.then((data) => {\n//   console.log(data)\n// }, () => {\n//\n// })\n\nconst Promise = require('./promise')\nconst fs = require('fs')\n\n// \u4e3a\u4ec0\u4e48\u8981\u5904\u7406\u94fe\u5f0f\u8c03\u7528 \u6211\u4eec\u5199\u4e00\u4e2a\u529f\u80fd \u5148\u8bfb\u53d6 a.txt \u6587\u4ef6\uff0c\u62ff\u5230\u5177\u4f53\u7684\u5185\u5bb9 \u8bfb\u53d6\u5185\u5bb9\u5bf9\u5e94\u7684\u6587\u4ef6\n// fs.readFile('./a.txt', 'utf8', function (err, data) {\n//   fs.readFile(data, 'utf8', function (err, data) {\n//     // \u56de\u8c03\u5730\u72f1 \u9519\u8bef\u4e0d\u597d\u5904\u7406\uff0c\u4ee3\u7801\u5168\u90e8\u8026\u5408\u5728\u4e00\u8d77\n//   })\n// })\n\nfunction readFile(...args) {\n  return new Promise((resolve, reject) => {\n    fs.readFile(...args, function (err, data) {\n      if (err) reject(err)\n      resolve(data)\n    })\n  })\n}\n\n// \u53ef\u4ee5\u5728 then \u65b9\u6cd5\uff08\u6210\u529f\u548c\u5931\u8d25\uff09\u4e2d\u8fd4\u56de\u4e00\u4e2a promise\uff0cpromise\u4f1a\u91c7\u7528\u8fd4\u56de\u7684 promise \u7684\u6210\u529f\u7684\u503c\u6216\u5931\u8d25\u539f\u56e0\n\n// 1. then \u65b9\u6cd5\u4e2d\u6210\u529f\u7684\u56de\u8c03\u6216\u8005\u5931\u8d25\u7684\u56de\u8c03\u8fd4\u56de\u7684\u662f\u4e00\u4e2apromise\uff0c\u90a3\u4e48\u91c7\u7528\u8fd4\u56de\u7684 promise \u7684\u72b6\u6001\uff0c\u8d70\u5916\u5c42\u4e0b\u4e00\u6b21 then \u4e2d\u7684\u6210\u529f\u6216\u5931\u8d25\uff0c\u540c\u65f6\u5c06promise\u5904\u7406\u540e\u7684\u7ed3\u679c\u5411\u4e0b\u4f20\u9012\n// 2. then \u65b9\u6cd5\u4e2d\uff0c\u6210\u529f\u7684\u56de\u8c03\u6216\u8005\u5931\u8d25\u7684\u56de\u8c03\u8fd4\u56de\u7684\u662f\u4e00\u4e2a\u666e\u901a\u503c\uff08\u4e0d\u662fpromise\uff09\u8fd9\u91cc\u4f1a\u5c06\u8fd4\u56de\u7684\u7ed3\u679c\u4f20\u9012\u5230\u4e0b\u4e00\u6b21 then \u6210\u529f\u4e2d\u53bb\n// 3. \u5982\u679c\u5728 then \u65b9\u6cd5\u4e2d\u6210\u529f\u7684\u56de\u8c03\u6216\u8005\u5931\u8d25\u7684\u56de\u8c03\uff0c\u6267\u884c\u51fa\u9519\u4f1a\u8d70\u5230\u5916\u5c42\u4e0b\u4e00\u4e2a then \u4e2d\u7684\u5931\u8d25\u4e2d\u53bb\nreadFile('./a.txt', 'utf8').then(data => {\n  console.log('success', data)\n  // return readFile(data, 'utf8');\n  throw new Error('1234')\n}, err => {\n  console.log('fail', err)\n}).then((data) => {\n  console.log(data)\n}, (err) => {\n  console.log('err', err)\n})\n\n// promise \u4e00\u65e6\u6210\u529f\u4e0d\u80fd\u5931\u8d25\n// \u5982\u679c\u8fd4\u56de\u7684\u662f\u4e00\u4e2a\u5931\u8d25\u7684 promise \u6216\u8005\u62a5\u9519\u4e86\u3002\u624d\u4f1a\u8d70\u4e0b\u4e00\u4e2a then \u7684\u5931\u8d25\uff0c\u5426\u5219\u5168\u90e8\u8d70\u6210\u529f\n// \u5982\u4f55\u5b9e\u73b0\u94fe\u5f0f\u8c03\u7528\uff1f return new Promise()",lang:"js"}),s.a.createElement("p",null,"promise/index.js"),s.a.createElement(a["a"],{code:'const PENDING = "PENDING"; // \u9ed8\u8ba4\u7b49\u5f85\u6001\nconst FULFILLED = "FULFILLED";  // \u6210\u529f\u6001\nconst REJECT = "REJECT";  // \u5931\u8d25\u6001\n\nfunction resolvePromise(x, promise2, resolve, reject) {\n  // \u5982\u679cx\u662f\u4e00\u4e2a\u666e\u901a\u503c\u5219\u76f4\u63a5\u8c03\u7528resolve\u5373\u53ef\n\n  // \u5982\u679cx\u662f\u4e00\u4e2apromise\u90a3\u4e48\u5e94\u8be5\u91c7\u7528\u8fd9\u4e2apromise\u7684\u72b6\u6001\u51b3\u5b9a\u8c03\u7528\u7684\u662fresolve\u8fd8\u662freject\n}\n\nclass Promise {\n  constructor(executor) { // executor \u4f1a\u9ed8\u8ba4\u6267\u884c \u540c\u6b65\u6267\u884c\n    this.status = PENDING\n    this.value = undefined\n    this.reason = undefined\n\n    this.onResolvedCallbacks = []\n    this.onRejectedCallbacks = []\n     // \u7528\u6237\u8c03\u7528 resolve \u548c reject \u53ef\u4ee5\u5c06\u5bf9\u5e94\u7684\u7ed3\u679c\u66b4\u9732\u5728\u5f53\u524d\u7684 promise \u5b9e\u4f8b\u4e0a\n    const resolve = (value) => {\n      if (this.status === PENDING) {\n        this.value = value\n        this.status = FULFILLED\n        this.onResolvedCallbacks.forEach(fn => fn())\n      }\n    }\n\n    const reject = (reason) => {\n      if (this.status === PENDING) {\n        this.reason = reason\n        this.status = REJECT\n        this.onRejectedCallbacks.forEach(fn => fn())\n      }\n    }\n\n    try {\n      executor(resolve, reject); // \u9ed8\u8ba4 new Promise\u4e2d\u7684\u51fd\u6570\u4f1a\u7acb\u5373\u6267\u884c\n    } catch (e) { // \u5982\u679c\u6267\u884c\u65f6\u51fa\u9519\uff0c\u6211\u4eec\u5c06\u9519\u8bef\u4f20\u9012\u5230 reject \u4e2d =\u300b \u6267\u884c\u5230\u4e86\u5931\u8d25\u903b\u8f91\n      reject(e)\n    }\n  }\n\n  then(onFulfilled, onRejected) {\n    // \u6bcf\u6b21\u8c03\u7528 then \u65b9\u6cd5\uff0c\u90fd\u5fc5\u987b\u8fd4\u56de\u4e00\u4e2a\u5168\u65b0\u7684 promise\n    let promise2 = new Promise((resolve, reject) => {\n      // NOTE: x \u5c31\u662f\u4e0a\u4e00\u4e2a then \u6210\u529f\u6216\u8005\u5931\u8d25\u7684\u8fd4\u56de\u503c\uff0c\u8fd9\u4e2a x \u51b3\u5b9a promise2 \u8d70\u6210\u529f\u8fd8\u662f\u8d70\u5931\u8d25\n      if (this.status === FULFILLED) {\n        setTimeout(() => {\n          try {\n            let x = onFulfilled(this.value)\n            resolvePromise(x, promise2, resolve, reject)\n          } catch(e) {\n            reject(e)\n          }\n        }, 0)\n      }\n\n      if (this.status === REJECT) {\n        setTimeout(() => {\n          try {\n            let x = onRejected(this.reason)\n            resolvePromise(x, promise2, resolve, reject)\n          } catch (e) {\n            reject(e)\n          }\n        }, 0)\n      }\n\n      if (this.status === PENDING) {\n        console.log(\'pending\')\n        // \u53d1\u5e03\u8ba2\u9605\u6a21\u5f0f\n        this.onResolvedCallbacks.push(() => {\n          setTimeout(() => {\n            try {\n              let x = onFulfilled(this.value)\n              resolvePromise(x, promise2, resolve, reject)\n            } catch(e) {\n              reject(e)\n            }\n          }, 0)\n        })\n        this.onRejectedCallbacks.push(() => {\n          setTimeout(() => {\n            try {\n              let x = onRejected(this.reason)\n              resolvePromise(x, promise2, resolve, reject)\n            } catch (e) {\n              reject(e)\n            }\n          }, 0)\n        })\n      }\n    })\n    return promise2\n  }\n}\n\nmodule.exports = Promise',lang:"js"})))}));n["default"]=e=>{var n=s.a.useContext(o["context"]),t=n.demos;return s.a.useEffect((()=>{var n;null!==e&&void 0!==e&&null!==(n=e.location)&&void 0!==n&&n.hash&&o["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),s.a.createElement(i,{demos:t})}}}]);