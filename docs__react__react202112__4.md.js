(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[45],{wvwc:function(e,n,t){"use strict";t.r(n);var o=t("q1tI"),a=t.n(o),r=t("dEAq"),d=t("H1Ra"),s=a.a.memo((e=>{e.demos;return a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:"markdown"},a.a.createElement("h1",{id:"\u5b9e\u73b0\u7c7b\u7ec4\u4ef6\u7684\u66f4\u65b0"},a.a.createElement(r["AnchorLink"],{to:"#\u5b9e\u73b0\u7c7b\u7ec4\u4ef6\u7684\u66f4\u65b0","aria-hidden":"true",tabIndex:-1},a.a.createElement("span",{className:"icon icon-link"})),"\u5b9e\u73b0\u7c7b\u7ec4\u4ef6\u7684\u66f4\u65b0"),a.a.createElement("h2",{id:"\u7ec4\u4ef6\u72b6\u6001"},a.a.createElement(r["AnchorLink"],{to:"#\u7ec4\u4ef6\u72b6\u6001","aria-hidden":"true",tabIndex:-1},a.a.createElement("span",{className:"icon icon-link"})),"\u7ec4\u4ef6\u72b6\u6001"),a.a.createElement("ul",null,a.a.createElement("li",null,"\u7ec4\u4ef6\u7684\u6570\u636e\u6765\u6e90\u6709\u4e24\u4e2a\u5730\u65b9\uff0c\u5206\u522b\u662f\u5c5e\u6027\u5bf9\u8c61\u548c\u72b6\u6001\u5bf9\u8c61"),a.a.createElement("li",null,"\u5c5e\u6027\u662f\u7236\u7ec4\u4ef6\u4f20\u9012\u8fc7\u6765\u7684"),a.a.createElement("li",null,"\u72b6\u6001\u662f\u81ea\u5df1\u5185\u90e8\u7684,\u6539\u53d8\u72b6\u6001\u552f\u4e00\u7684\u65b9\u5f0f\u5c31\u662f",a.a.createElement("code",null,"setState")),a.a.createElement("li",null,"\u5c5e\u6027\u548c\u72b6\u6001\u7684\u53d8\u5316\u90fd\u4f1a\u5f71\u54cd\u89c6\u56fe\u66f4\u65b0"),a.a.createElement("li",null,"\u4e0d\u8981\u76f4\u63a5\u4fee\u6539 State\uff0c\u6784\u9020\u51fd\u6570\u662f\u552f\u4e00\u53ef\u4ee5\u7ed9 this.state \u8d4b\u503c\u7684\u5730\u65b9")),a.a.createElement("h2",{id:"\u66f4\u65b0\u7ec4\u65b0\u5b9e\u73b0"},a.a.createElement(r["AnchorLink"],{to:"#\u66f4\u65b0\u7ec4\u65b0\u5b9e\u73b0","aria-hidden":"true",tabIndex:-1},a.a.createElement("span",{className:"icon icon-link"})),"\u66f4\u65b0\u7ec4\u65b0\u5b9e\u73b0"),a.a.createElement("h4",{id:"srcindexjs"},a.a.createElement(r["AnchorLink"],{to:"#srcindexjs","aria-hidden":"true",tabIndex:-1},a.a.createElement("span",{className:"icon icon-link"})),"src\\index.js"),a.a.createElement(d["a"],{code:'import React from "./react";\nimport ReactDOM from "./react-dom";\nclass Counter extends React.Component {\n    constructor(props) {\n        super(props);\n        this.state = { number: 0 };\n    }\n    handleClick = () => {\n        this.setState({ number: this.state.number + 1 });\n        console.log(this.state);\n\n    }\n    render() {\n        return (\n            <div>\n                <p>{this.props.title}</p>\n                <p>number:{this.state.number}</p>\n                <button onClick={this.handleClick}>+</button>\n            </div>\n        )\n    }\n}\nReactDOM.render(<Counter title="\u8ba1\u6570\u5668" />, document.getElementById("root"));',lang:"diff"}),a.a.createElement("h4",{id:"srccomponentjs"},a.a.createElement(r["AnchorLink"],{to:"#srccomponentjs","aria-hidden":"true",tabIndex:-1},a.a.createElement("span",{className:"icon icon-link"})),"src\\Component.js"),a.a.createElement(d["a"],{code:"+import { findDOM, compareTwoVdom } from './react-dom';\n+class Updater {\n+    constructor(classInstance) {\n+        this.classInstance = classInstance;\n+        this.pendingStates = [];\n+        this.callbacks = [];\n+    }\n+    addState(partialState, callback) {\n+        this.pendingStates.push(partialState);///\u7b49\u5f85\u66f4\u65b0\u7684\u6216\u8005\u8bf4\u7b49\u5f85\u751f\u6548\u7684\u72b6\u6001\n+        if (typeof callback === 'function')\n+            this.callbacks.push(callback);//\u72b6\u6001\u66f4\u65b0\u540e\u7684\u56de\u8c03\n+        this.emitUpdate();\n+    }\n+    emitUpdate() {\n+        this.updateComponent();\n+    }\n+    updateComponent() {\n+        let { classInstance, pendingStates } = this;\n+        if (pendingStates.length > 0) {\n+            shouldUpdate(classInstance, this.getState());\n+        }\n+    }\n+    getState() {\n+        let { classInstance, pendingStates } = this;\n+        let { state } = classInstance;\n+        pendingStates.forEach((nextState) => {\n+            if (typeof nextState === 'function') {\n+                nextState = nextState(state);\n+            }\n+            state = { ...state, ...nextState };\n+        });\n+        pendingStates.length = 0;\n+        return state;\n+    }\n+}\n+function shouldUpdate(classInstance, nextState) {\n+    classInstance.state = nextState;\n+    classInstance.forceUpdate();\n+}\nexport class Component {\n    static isReactComponent = true;\n    constructor(props) {\n        this.props = props;\n+        this.state = {};\n+        this.updater = new Updater(this);\n    }\n+    setState(partialState, callback) {\n+        this.updater.addState(partialState, callback);\n+    }\n+    forceUpdate() {\n+        let oldRenderVdom = this.oldRenderVdom;\n+        let oldDOM = findDOM(oldRenderVdom);\n+        let newRenderVdom = this.render();\n+        compareTwoVdom(oldDOM.parentNode, oldRenderVdom, newRenderVdom);\n+        this.oldRenderVdom = newRenderVdom;\n+    }\n+}",lang:"diff"}),a.a.createElement("h4",{id:"react-domjs"},a.a.createElement(r["AnchorLink"],{to:"#react-domjs","aria-hidden":"true",tabIndex:-1},a.a.createElement("span",{className:"icon icon-link"})),"react-dom.js"),a.a.createElement(d["a"],{code:'import { REACT_TEXT } from "./constants";\nfunction render(vdom, parentDOM) {\n    let newDOM = createDOM(vdom)\n    if (newDOM) {\n        parentDOM.appendChild(newDOM);\n    }\n}\nexport function createDOM(vdom) {\n  let { type, props } = vdom;\n  let dom;\n  if (type === REACT_TEXT) {\n    dom = document.createTextNode(props);\n  } else if (typeof type === "function") {\n    if (type.isReactComponent) {\n      return mountClassComponent(vdom);\n    } else {\n      return mountFunctionComponent(vdom);\n    }\n  } else {\n    dom = document.createElement(type);\n  }\n  if (props) {\n    updateProps(dom, {}, props);\n    if (typeof props.children == "object" && props.children.type) {\n      mount(props.children, dom);\n    } else if (Array.isArray(props.children)) {\n      reconcileChildren(props.children, dom);\n    }\n  }\n  vdom.dom = dom;\n  return dom;\n}\nfunction mountClassComponent(vdom) {\n  let { type, props } = vdom;\n  let classInstance = new type(props);\n  let renderVdom = classInstance.render();\n+ classInstance.oldRenderVdom = renderVdom;\n  let dom = createDOM(renderVdom);\n  return dom;\n}\nfunction mountFunctionComponent(vdom) {\n  let { type, props } = vdom;\n  let renderVdom = type(props);\n+ vdom.oldRenderVdom = renderVdom;\n  return createDOM(renderVdom);\n}\nfunction updateProps(dom, oldProps={}, newProps={}) {\n    for (let key in newProps) {\n        if (key === \'children\') {\n            continue;\n        } else if (key === \'style\') {\n            let styleObj = newProps[key];\n            for (let attr in styleObj) {\n                dom.style[attr] = styleObj[attr];\n            }\n+       } else if (/^on[A-Z].*/.test(key)) {\n+           dom[key.toLowerCase()]=newProps[key];\n+       } else {\n            dom[key] = newProps[key];\n        }\n    }\n    for(let key in oldProps){\n        if(!newProps.hasOwnProperty(key)){\n            dom[key] = null;\n        }\n    }\n}\n+export function findDOM(vdom) {\n+    if (!vdom) return null;\n+    if (vdom.dom) {\n+        return vdom.dom;\n+    } else {\n+        let renderVdom = vdom.oldRenderVdom;\n+        return findDOM(renderVdom);\n+    }\n+}\n\n\n+export function compareTwoVdom(parentDOM, oldVdom, newVdom) {\n+    let oldDOM = findDOM(oldVdom);\n+    let newDOM = createDOM(newVdom);\n+    parentDOM.replaceChild(newDOM, oldDOM);\n+}\nfunction reconcileChildren(childrenVdom, parentDOM) {\n  for (let i = 0; i < childrenVdom.length; i++) {\n    let childVdom = childrenVdom[i];\n    mount(childVdom, parentDOM);\n  }\n}\nconst ReactDOM = {\n  render,\n};\nexport default ReactDOM;',lang:"diff"})))}));n["default"]=e=>{var n=a.a.useContext(r["context"]),t=n.demos;return a.a.useEffect((()=>{var n;null!==e&&void 0!==e&&null!==(n=e.location)&&void 0!==n&&n.hash&&r["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),a.a.createElement(s,{demos:t})}}}]);