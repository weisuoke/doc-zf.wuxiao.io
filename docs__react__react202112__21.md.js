(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[30],{X2LY:function(e,n,t){"use strict";t.r(n);var a=t("q1tI"),r=t.n(a),c=t("dEAq"),o=t("H1Ra"),l=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("h1",{id:"uselayouteffect--useimperativehandle"},r.a.createElement(c["AnchorLink"],{to:"#uselayouteffect--useimperativehandle","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"useLayoutEffect + useImperativeHandle"),r.a.createElement("h2",{id:"uselayouteffect"},r.a.createElement(c["AnchorLink"],{to:"#uselayouteffect","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"useLayoutEffect"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u5176\u51fd\u6570\u7b7e\u540d\u4e0e ",r.a.createElement("code",null,"useEffect")," \u76f8\u540c\uff0c\u4f46\u5b83\u4f1a\u5728\u6240\u6709\u7684 ",r.a.createElement("code",null,"DOM")," \u53d8\u66f4\u4e4b\u540e\u540c\u6b65\u8c03\u7528 effect"),r.a.createElement("li",null,r.a.createElement("code",null,"useEffect"),"\u4e0d\u4f1a\u963b\u585e\u6d4f\u89c8\u5668\u6e32\u67d3\uff0c\u800c ",r.a.createElement("code",null,"useLayoutEffect")," \u4f1a\u6d4f\u89c8\u5668\u6e32\u67d3"),r.a.createElement("li",null,r.a.createElement("code",null,"useEffect"),"\u4f1a\u5728\u6d4f\u89c8\u5668\u6e32\u67d3\u7ed3\u675f\u540e\u6267\u884c,",r.a.createElement("code",null,"useLayoutEffect")," \u5219\u662f\u5728 ",r.a.createElement("code",null,"DOM")," \u66f4\u65b0\u5b8c\u6210\u540e,\u6d4f\u89c8\u5668\u7ed8\u5236\u4e4b\u524d\u6267\u884c")),r.a.createElement("h3",{id:"\u4e8b\u4ef6\u5faa\u73af"},r.a.createElement(c["AnchorLink"],{to:"#\u4e8b\u4ef6\u5faa\u73af","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u4e8b\u4ef6\u5faa\u73af"),r.a.createElement("p",null,r.a.createElement("img",{src:"http://wuxiao-tech-doc.oss-cn-hangzhou.aliyuncs.com/2022-02-03-024147.png",alt:"img"})),r.a.createElement("h3",{id:"srcindexjs"},r.a.createElement(c["AnchorLink"],{to:"#srcindexjs","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"src\\index.js"),r.a.createElement("p",null,"src\\index.js"),r.a.createElement(o["a"],{code:"import React from './react';\nimport ReactDOM from './react-dom';\n\nconst Animate = ()=>{\n    const ref = React.useRef();\n    React.useLayoutEffect(() => {\n      ref.current.style.transform = `translate(500px)`;//TODO\n      ref.current.style.transition = `all 500ms`;\n    });\n    let style = {\n      width: '100px',\n      height: '100px',\n      borderRadius: '50%',\n      backgroundColor: 'red'\n    }\n    return (\n      <div style={style} ref={ref}></div>\n    )\n}\nReactDOM.render(<Animate/>,document.getElementById('root'));",lang:"js"}),r.a.createElement("h3",{id:"srcreact-domjs"},r.a.createElement(c["AnchorLink"],{to:"#srcreact-domjs","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"src\\react-dom.js"),r.a.createElement(o["a"],{code:"+ export function useRef(initialState) {\n+   hookStates[hookIndex] = hookStates[hookIndex] || { current: initialState }\n+   return hookStates[hookIndex++]\n+ }\n\n+ export function useLayoutEffect(callback, deps) {\n+   let currentIndex = hookIndex;\n+   if (hookStates[hookIndex]) {\n+     let [lastDestroy, oldDeps] = hookStates[hookIndex];\n+     let same = deps && deps.every((dep, index) => dep === oldDeps[index])\n+     if (same) {\n+       hookIndex++\n+     } else {\n+       lastDestroy && lastDestroy()\n+       queueMicrotask(() => {\n+         // \u6267\u884c callback \u51fd\u6570\uff0c\u8fd4\u56de\u4e00\u4e2a\u9500\u6bc1\u51fd\u6570\n+         let destroy = callback()\n+         hookStates[currentIndex] = [destroy, deps]\n+       })\n+       hookIndex++\n+     }\n+   } else {\n+     // \u5f00\u542f\u4e00\u4e2a\u65b0\u7684\u5fae\u4efb\u52a1\n+     queueMicrotask(() => {\n+       // \u6267\u884c callback \u51fd\u6570\uff0c\u8fd4\u56de\u4e00\u4e2a\u9500\u6bc1\u51fd\u6570\n+       let destroy = callback()\n+       hookStates[currentIndex] = [destroy, deps]\n+     })\n+     hookIndex++\n+   }\n+ }",lang:"diff"}),r.a.createElement("h2",{id:"forwardrefuseimperativehandle"},r.a.createElement(c["AnchorLink"],{to:"#forwardrefuseimperativehandle","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"forwardRef+useImperativeHandle"),r.a.createElement("ul",null,r.a.createElement("li",null,"forwardRef\u5c06ref\u4ece\u7236\u7ec4\u4ef6\u4e2d\u8f6c\u53d1\u5230\u5b50\u7ec4\u4ef6\u4e2d\u7684dom\u5143\u7d20\u4e0a,\u5b50\u7ec4\u4ef6\u63a5\u53d7props\u548cref\u4f5c\u4e3a\u53c2\u6570"),r.a.createElement("li",null,r.a.createElement("code",null,"useImperativeHandle")," \u53ef\u4ee5\u8ba9\u4f60\u5728\u4f7f\u7528 ref \u65f6\u81ea\u5b9a\u4e49\u66b4\u9732\u7ed9\u7236\u7ec4\u4ef6\u7684\u5b9e\u4f8b\u503c")),r.a.createElement("h3",{id:"srcindexjs-1"},r.a.createElement(c["AnchorLink"],{to:"#srcindexjs-1","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"src\\index.js"),r.a.createElement(o["a"],{code:"import React from './react';\nimport ReactDOM from './react-dom';\n\nfunction Child(props, ref) {\n    const inputRef = React.useRef();\n    React.useImperativeHandle(ref, () => (\n        {\n            focus() {\n                inputRef.current.focus();\n            }\n        }\n    ));\n    return (\n        <input type=\"text\" ref={inputRef} />\n    )\n}\nconst ForwardChild = React.forwardRef(Child);\nfunction Parent() {\n    let [number, setNumber] = React.useState(0);\n    const inputRef = React.useRef();\n    function getFocus() {\n        console.log(inputRef.current);\n        inputRef.current.value = 'focus';\n        inputRef.current.focus();\n    }\n    return (\n        <div>\n            <ForwardChild ref={inputRef} />\n            <button onClick={getFocus}>\u83b7\u5f97\u7126\u70b9</button>\n            <p>{number}</p>\n            <button onClick={() => {\n                debugger\n                setNumber( number + 1)\n            }}>+</button>\n        </div>\n    )\n}\nReactDOM.render(<Parent/>,document.getElementById('root'));",lang:"js"}),r.a.createElement("h3",{id:"srcreact-domjs-1"},r.a.createElement(c["AnchorLink"],{to:"#srcreact-domjs-1","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"src\\react-dom.js"),r.a.createElement(o["a"],{code:"+export function useImperativeHandle(ref,handler){\n+    ref.current = handler();\n+}",lang:"diff"})))}));n["default"]=e=>{var n=r.a.useContext(c["context"]),t=n.demos;return r.a.useEffect((()=>{var n;null!==e&&void 0!==e&&null!==(n=e.location)&&void 0!==n&&n.hash&&c["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(l,{demos:t})}}}]);