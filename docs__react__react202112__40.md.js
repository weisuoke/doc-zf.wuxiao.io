(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[46],{Ay1O:function(e,t,n){"use strict";n.r(t);var r=n("q1tI"),o=n.n(r),a=n("dEAq"),c=n("H1Ra"),s=o.a.memo((e=>{e.demos;return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"markdown"},o.a.createElement("h1",{id:"\u5b9e\u73b0react-redux"},o.a.createElement(a["AnchorLink"],{to:"#\u5b9e\u73b0react-redux","aria-hidden":"true",tabIndex:-1},o.a.createElement("span",{className:"icon icon-link"})),"\u5b9e\u73b0react-redux"),o.a.createElement("h2",{id:"srcindexjs"},o.a.createElement(a["AnchorLink"],{to:"#srcindexjs","aria-hidden":"true",tabIndex:-1},o.a.createElement("span",{className:"icon icon-link"})),"src/index.js"),o.a.createElement(c["a"],{code:"import React from 'react'\nimport ReactDOM from 'react-dom'\nimport Counter1 from './components/Counter1'\nimport Counter2 from './components/Counter2'\nimport store from './store'\nimport { Provider } from \"./react-redux\";\n\nReactDOM.render(\n  <Provider store={store}>\n    <Counter1 />\n    <hr/>\n    <Counter2 />\n  </Provider>,\n  document.getElementById('root')\n)",lang:"js"}),o.a.createElement("h2",{id:"srccomponentscounter1js"},o.a.createElement(a["AnchorLink"],{to:"#srccomponentscounter1js","aria-hidden":"true",tabIndex:-1},o.a.createElement("span",{className:"icon icon-link"})),"src/components/Counter1.js"),o.a.createElement(c["a"],{code:"import React from 'react'\nimport actionCreators from \"../store/actionCreators/counter1\";\nimport { useSelector, useBoundDispatch } from  '../react-redux'\n\nfunction Counter1() {\n  let state = useSelector((state) => state.counter1)\n  let dispatch = useBoundDispatch(actionCreators);\n  return (\n    <div>\n      <p>{state.number}</p>\n      <button onClick={dispatch.add}>+</button>\n      <button onClick={dispatch.minus}>-</button>\n    </div>\n  )\n}\n\nexport default Counter1",lang:"js"}),o.a.createElement("h2",{id:"srccomponentscounter2js"},o.a.createElement(a["AnchorLink"],{to:"#srccomponentscounter2js","aria-hidden":"true",tabIndex:-1},o.a.createElement("span",{className:"icon icon-link"})),"src/components/Counter2.js"),o.a.createElement(c["a"],{code:'import React from \'react\'\nimport actionCreators from "../store/actionCreators/counter2";\nimport {connect} from "../react-redux";\n\nclass Counter2 extends React.Component {\n  render() {\n    return (\n      <div>\n        <p>{this.props.number}</p>\n        <button onClick={this.props.add2}>+</button>\n        <button onClick={this.props.minus2}>-</button>\n      </div>\n    );\n  }\n}\n\nconst mapStateToProps = (state) => state.counter2;  // {number: 0}\n\n// \u628a\u4ed3\u5e93\u4e2d\u7684\u72b6\u6001\u6620\u5c04\u4e3a\u6b64\u7ec4\u4ef6\u7684\u5c5e\u6027\u5bf9\u8c61\nexport default connect(mapStateToProps, actionCreators)(Counter2)',lang:"js"}),o.a.createElement("h2",{id:"react-redux"},o.a.createElement(a["AnchorLink"],{to:"#react-redux","aria-hidden":"true",tabIndex:-1},o.a.createElement("span",{className:"icon icon-link"})),"react-redux"),o.a.createElement("h3",{id:"srcreact-reduxindexjs"},o.a.createElement(a["AnchorLink"],{to:"#srcreact-reduxindexjs","aria-hidden":"true",tabIndex:-1},o.a.createElement("span",{className:"icon icon-link"})),"src/react-redux/index.js"),o.a.createElement(c["a"],{code:"export { default as Provider } from './Provider'\nexport { default as connect } from './connect'\nexport * from './hooks'",lang:"js"}),o.a.createElement("h3",{id:"srcreact-reduxconnectjs"},o.a.createElement(a["AnchorLink"],{to:"#srcreact-reduxconnectjs","aria-hidden":"true",tabIndex:-1},o.a.createElement("span",{className:"icon icon-link"})),"src/react-redux/connect.js"),o.a.createElement(c["a"],{code:'import React from "react";\nimport ReactReduxContext from "./ReactReduxContext";\nimport { bindActionCreators } from "../redux";\n\n/**\n * \u8fde\u63a5\u7ec4\u4ef6\u548c\u4ed3\u5e93\n * @param mapStateToProps \u628a\u4ed3\u5e93\u4e2d\u7684\u72b6\u6001\u53d8\u6210\u7ec4\u4ef6\u7684\u5c5e\u6027\n * @param mapDispatchToProps \u628a dispatch \u65b9\u6cd5\u53d8\u6210\u7ec4\u4ef6\u7684\u5c5e\u6027\n * @returns {function(*): *}\n */\nfunction connect(mapStateToProps, mapDispatchToProps) {\n  return function (OldComponent) {\n    return class extends React.Component {\n      static contextType = ReactReduxContext\n      constructor(props, context) {\n        super(props);\n        const { store } = context;\n        const { getState, subscribe, dispatch } = store;\n        this.state = mapStateToProps(getState())\n        this.dispatchProps = bindActionCreators(mapDispatchToProps, dispatch)\n      }\n\n      componentDidMount() {\n        let store = this.context.store\n        this.unsubscribe = store.subscribe(() => {\n          this.setState(mapStateToProps(store.getState()))\n        })\n      }\n\n      componentWillUnmount() {\n        this.unsubscribe();\n      }\n\n      render() {\n        return <OldComponent {...this.props} {...this.state} {...this.dispatchProps}/>\n      }\n    }\n  }\n}\n\n// connect \u7684\u51fd\u6570\u5b9e\u73b0 connect1\nfunction connect1(mapStateToProps, mapDispatchToProps) {\n  return function (OldComponent) {\n    return function(props) {\n      let { store } = React.useContext(ReactReduxContext)\n      const { getState, dispatch, subscribe } = store\n      const prevState = getState()\n      const stateProps = React.useMemo(() => mapStateToProps(prevState), [prevState])\n      const dispatchProps = React.useMemo(() => {\n        // \u5176\u5b9e mapDispatchToPropsyou\u591a\u79cd\u5199\u6cd5\n        if (typeof mapDispatchToProps === \'function\') {\n          return mapDispatchToProps(dispatch)\n        } else if (typeof mapDispatchToProps === \'object\' && mapDispatchToProps !== null) {\n          return bindActionCreators(mapDispatchToProps, dispatch)\n        } else {\n          return {\n            dispatch\n          }\n        }\n      }, [dispatch])\n      const [, forceUpdate] = React.useReducer(x => x + 1, 0);\n      React.useLayoutEffect(() => {\n        return subscribe(forceUpdate)\n      }, [subscribe])\n      return <OldComponent {...props} {...stateProps} {...dispatchProps}/>\n    }\n  }\n}\n\nexport default connect1',lang:"js"}),o.a.createElement("h3",{id:"srcreact-reduxproviderjs"},o.a.createElement(a["AnchorLink"],{to:"#srcreact-reduxproviderjs","aria-hidden":"true",tabIndex:-1},o.a.createElement("span",{className:"icon icon-link"})),"src/react-redux/Provider.js"),o.a.createElement(c["a"],{code:"import React from 'react'\nimport ReactReduxContext from \"./ReactReduxContext\";\n\nfunction Provider({ store, children }) {\n  return (\n    <ReactReduxContext.Provider value={{ store }}>\n      {children}\n    </ReactReduxContext.Provider>\n  )\n}\n\nexport default Provider",lang:"js"}),o.a.createElement("h3",{id:"srcreact-reduxreactreduxcontextjs"},o.a.createElement(a["AnchorLink"],{to:"#srcreact-reduxreactreduxcontextjs","aria-hidden":"true",tabIndex:-1},o.a.createElement("span",{className:"icon icon-link"})),"src/react-redux/ReactReduxContext.js"),o.a.createElement(c["a"],{code:"import React from 'react'\nexport const ReactReduxContext = React.createContext();\nexport default ReactReduxContext",lang:"js"}),o.a.createElement("h3",{id:"srcreact-reduxhooksindexjs"},o.a.createElement(a["AnchorLink"],{to:"#srcreact-reduxhooksindexjs","aria-hidden":"true",tabIndex:-1},o.a.createElement("span",{className:"icon icon-link"})),"src/react-redux/hooks/index.js"),o.a.createElement(c["a"],{code:"export { default as Provider } from './Provider'\nexport { default as connect } from './connect'\nexport * from './hooks'",lang:"js"}),o.a.createElement("h3",{id:"srcreact-reduxhooksusedispatchjs"},o.a.createElement(a["AnchorLink"],{to:"#srcreact-reduxhooksusedispatchjs","aria-hidden":"true",tabIndex:-1},o.a.createElement("span",{className:"icon icon-link"})),"src/react-redux/hooks/useDispatch.js"),o.a.createElement(c["a"],{code:"import React from 'react'\nimport ReactReduxContext from \"../ReactReduxContext\";\n\nconst useDispatch = () => {\n  const { store } = React.useContext(ReactReduxContext)\n  return store.dispatch;\n}\n\nexport default useDispatch",lang:"js"}),o.a.createElement("h3",{id:"srcreact-reduxhooksuseselectorjs"},o.a.createElement(a["AnchorLink"],{to:"#srcreact-reduxhooksuseselectorjs","aria-hidden":"true",tabIndex:-1},o.a.createElement("span",{className:"icon icon-link"})),"src/react-redux/hooks/useSelector.js"),o.a.createElement(c["a"],{code:"import React from 'react'\nimport ReactReduxContext from \"../ReactReduxContext\";\n\nconst useSelector = (selector, equalityFn = shallowEqual) => {\n  const { store } = React.useContext(ReactReduxContext)\n  let state = store.getState()\n  let lastSelectedState = React.useRef(null)\n  let selectedState = selector(state);\n  let [, forceUpdate] = React.useReducer(x => x + 1, 0)\n  React.useLayoutEffect(() => {\n    return store.subscribe(() => {\n      let selectedState = selector(store.getState())\n      if (!equalityFn(selectedState, lastSelectedState.current)) {\n        forceUpdate()\n        lastSelectedState.current = selectedState\n      }\n    })\n  }, [equalityFn, selector, store])\n  return selectedState;\n}\n\n/**\n * \u6d45\u6bd4\u8f83\u4e24\u4e2a\u5bf9\u8c61\n * @param obj1 \u5bf9\u8c611\n * @param obj2 \u5bf9\u8c612\n */\nexport function shallowEqual(obj1, obj2) {\n  if (obj1 === obj2) {\n    return true\n  }\n  if (typeof obj1 !== 'object' || obj1 === null || typeof obj2 !== 'object' || obj2 === null) {\n    return false\n  }\n  // \u5982\u679c\u90fd\u662f\u5bf9\u8c61\uff0c\u5e76\u4e14\u5c5e\u6027\u90fd\u662f\u5b58\u5728\u7684\n  let keys1 = Object.keys(obj1);\n  let keys2 = Object.keys(obj2);\n  if (keys1.length !== keys2.length) {\n    return false\n  }\n  for (let key of keys1) {\n    if (!obj2.hasOwnProperty(key) || obj1[key] !== obj2[key]) {\n      return false;\n    }\n  }\n\n  return true\n}\n\nexport default useSelector;",lang:"js"}),o.a.createElement("h3",{id:"srcreact-reduxusebounddispatchjs"},o.a.createElement(a["AnchorLink"],{to:"#srcreact-reduxusebounddispatchjs","aria-hidden":"true",tabIndex:-1},o.a.createElement("span",{className:"icon icon-link"})),"src/react-redux/useBoundDispatch.js"),o.a.createElement(c["a"],{code:'import React from \'react\'\nimport ReactReduxContext from "../ReactReduxContext";\nimport { bindActionCreators } from "../../redux";\n\nfunction useBoundDispatch(actionCreators) {\n  const { store } = React.useContext(ReactReduxContext)\n  const boundActionCreators = bindActionCreators(actionCreators, store.dispatch)\n  return boundActionCreators;\n}\n\nexport default useBoundDispatch',lang:"js"})))}));t["default"]=e=>{var t=o.a.useContext(a["context"]),n=t.demos;return o.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&a["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),o.a.createElement(s,{demos:n})}}}]);